<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trainer Dashboard - Fit and Lift</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background: linear-gradient(180deg, #0a0a0a 0%, #121212 100%);
        color: #fff;
    }

    /* Navbar */
    nav {
        position: sticky;
        top: 0;
        width: 100%;
        background: rgba(0,0,0,0.95);
        padding: 15px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.7);
        z-index: 1000;
        backdrop-filter: blur(5px);
    }

    nav .logo {
        font-size: 26px;
        font-weight: bold;
        color: #f9d342;
    }

    nav ul {
        list-style: none;
        display: flex;
        gap: 25px;
    }

    nav ul li a {
        text-decoration: none;
        color: #fff;
        transition: 0.3s;
    }

    nav ul li a:hover {
        color: #f9d342;
    }

    .container {
        width: 90%;
        max-width: 1200px;
        margin: 20px auto;
    }

    h1 {
        color: #f9d342;
        text-align: center;
    }

    h2 {
        margin-top: 30px;
        color: #f9d342;
        border-left: 5px solid #f9d342;
        padding-left: 10px;
    }

    .card {
        background: rgba(255,255,255,0.05);
        padding: 20px;
        border-radius: 16px;
        margin-top: 15px;
    }

    input, select {
        padding: 10px;
        margin: 5px 0;
        width: 250px;
        border-radius: 8px;
        border: none;
        background: rgba(255,255,255,0.1);
        color: white;
    }

    button {
        background: linear-gradient(90deg, #f9d342, #ffc107);
        padding: 10px 15px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: bold;
    }

    table {
        width: 100%;
        margin-top: 15px;
        border-collapse: collapse;
    }

    th {
        background: #f9d342;
        color: black;
        padding: 12px;
    }

    td {
        padding: 12px;
        border-bottom: 1px solid #333;
    }

    /* Suggestions dropdown */
    .suggestions {
        position: absolute;
        background: #111;
        border: 1px solid #ffcc00;
        width: 250px;
        max-height: 180px;
        overflow-y: auto;
        border-radius: 6px;
        display: none;
        z-index: 9999;
    }
    .suggestions div {
        padding: 10px;
        cursor: pointer;
        color: white;
    }
    .suggestions div:hover {
        background: #ffcc00;
        color: black;
    }
</style>
</head>
<body>

<nav>
    <div class="logo">Fit and Lift</div>
    <ul>
        <li><a href="trainerDashboard.html">Dashboard</a></li>
        <li><a href="trainerMember.html">Members</a></li>
        <li><a href="attendance.html">Attendance</a></li>
        <li><a href="login.html">Logout</a></li>
    </ul>
</nav>

<div class="container">
    <h1>Trainer Dashboard</h1>

    <!-- Manage Schedule -->
    <h2>Manage Schedule</h2>
    <div class="card">
        <label for="scheduleMember">Member</label>
        <input type="text" id="scheduleMember" placeholder="Search Member">
        <div class="suggestions" id="scheduleMemberSuggestions"></div>

        <label for="scheduleDate">Member Start Date</label>
        <input type="date" id="scheduleDate" readonly>

        <label for="scheduleDay">Training Date</label>
        <input type="date" id="scheduleDay">

        <label for="scheduleTime">Training Time</label>
        <input type="time" id="scheduleTime">

        <button onclick="addSchedule()">Add Schedule</button>

        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>Member</th>
                    <th>Start Date</th>
                    <th>Schedule Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Class Attendance -->
    <h2>Class Attendance</h2>
    <div class="card">
        <label for="attName">Member</label>
        <input type="text" id="attName" placeholder="Search Member">
        <div class="suggestions" id="attNameSuggestions"></div>

        <label for="attDate">Date</label>
        <input type="date" id="attDate">

        <label for="attStatus">Status</label>
        <select id="attStatus">
            <option>Present</option>
            <option>Absent</option>
        </select>

        <button onclick="addAttendance()">Add Attendance</button>

        <table id="attendanceTable">
            <thead>
                <tr>
                    <th>Member</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>


</div>

<script>
const API_URL = "http://127.0.0.1:5000";
// Generic function for live search suggestions
async function showSuggestions(inputId, dropdownId, dateInputId) {
    const input = document.getElementById(inputId);
    const dropdown = document.getElementById(dropdownId);
    const scheduleDateInput = document.getElementById(dateInputId); // Schedule Date input
    const query = input.value.trim();

    if (!query) {
        dropdown.style.display = "none";
        dropdown.innerHTML = "";
        return;
    }

    try {
        const res = await fetch(`${API_URL}/members?q=${encodeURIComponent(query)}`);
        const data = await res.json();

        dropdown.innerHTML = "";

        if (!Array.isArray(data) || data.length === 0) {
            dropdown.style.display = "none";
            return;
        }

        data.forEach(member => {
            if (!member.firstName && !member.lastName) return;

            const item = document.createElement("div");
            item.innerHTML = `
                <strong>${member.firstName} ${member.lastName}</strong><br>
                <small>Start Date: ${member.startDate || "N/A"}</small>
            `;
            item.onclick = () => {
                input.value = `${member.firstName} ${member.lastName}`;
                dropdown.style.display = "none";

                // Fill the Schedule Date input with start date
                if (member.startDate) {
                    scheduleDateInput.value = member.startDate;
                } else {
                    scheduleDateInput.value = ""; // clear if no date
                }
            };
            dropdown.appendChild(item);
        });

        dropdown.style.display = "block";
    } catch (err) {
        console.error("Error fetching members:", err);
        dropdown.style.display = "none";
    }
    item.onclick = () => {
    input.value = `${member.firstName} ${member.lastName}`;
    input.dataset.username = member.username; // store username in input
    dropdown.style.display = "none";

    if (member.startDate) {
        scheduleDateInput.value = member.startDate;
    } else {
        scheduleDateInput.value = "";
    }
};

}

// Attach listeners with date input
document.getElementById("scheduleMember").addEventListener("input", () => {
    showSuggestions("scheduleMember", "scheduleMemberSuggestions", "scheduleDate");
});
document.getElementById("attName").addEventListener("input", () => {
    showSuggestions("attName", "attNameSuggestions", "attDate"); // optional for attendance
});
async function addSchedule() {
    const member = document.getElementById("scheduleMember").value.trim();
const startDate = document.getElementById("scheduleDate").value;
const scheduleDate = document.getElementById("scheduleDay").value;

const username = document.getElementById("scheduleMember").dataset.username;
if (!username || !startDate || !scheduleDate) {
    alert("Please select a member, start date, and scheduled date.");
    return;
}


    // Prepare data to send
    const [firstName, lastName] = member.split(" ");
    const payload = {
        username,
        firstName,
        lastName,
        startDate,
        scheduleDate,
        scheduleTime // <-- add this
    };

    try {
        const res = await fetch(`${API_URL}/addSchedule`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (res.ok) {
            // Add to table
            const tableBody = document.getElementById("scheduleTable").querySelector("tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${member}</td>
                <td>${startDate}</td>
                <td>${scheduleDate} ${scheduleTime}</td>
                <td><button onclick="this.closest('tr').remove()">Delete</button></td>
            `;
            tableBody.appendChild(row);

            // Clear inputs
            document.getElementById("scheduleMember").value = "";
            document.getElementById("scheduleDate").value = "";
            document.getElementById("scheduleDay").value = "";
            document.getElementById("scheduleTime").value = "";

            alert("Schedule added successfully!");
        } else {
            alert("Failed to add schedule: " + data.message);
        }
    } catch (err) {
        console.error(err);
        alert("Error adding schedule.");
    }
}


</script>

</body>
</html>